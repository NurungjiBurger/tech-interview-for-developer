<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Gemini CS ë©´ì ‘ê´€ (ëœë¤)</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
        #chatbox { height: 400px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        .user-msg, .gemini-msg { margin: 10px 0; }
        .user-msg { text-align: right; }
        .gemini-msg { background-color: #f1f1f1; padding: 10px; border-radius: 5px; }
        #controls { display: flex; }
        #userInput { flex-grow: 1; padding: 10px; }
        button { padding: 10px; margin-left: 5px; } /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì•½ê°„ ìˆ˜ì • */
    </style>
</head>
<body>
    <h1>ğŸ¤– Gemini CS ë©´ì ‘ê´€ (ëœë¤ ì§ˆë¬¸)</h1>

    <div id="chatbox">
        <div class="gemini-msg">ì•ˆë…•í•˜ì„¸ìš”! 'ì§ˆë¬¸ ì‹œì‘'ì´ë¼ê³  ì…ë ¥í•˜ì—¬ ë¬´ì‘ìœ„ CS ê¸°ìˆ  ë©´ì ‘ì„ ì‹œì‘í•˜ì„¸ìš”. ì œê°€ ëª¨ë“  ì£¼ì œì—ì„œ ì•Œì•„ì„œ ì§ˆë¬¸í•˜ê² ìŠµë‹ˆë‹¤.</div>
    </div>
    <div id="controls">
        <input type="text" id="userInput" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”...">
        <button id="sendBtn">ì „ì†¡</button>
        <button id="nextBtn">ë‹¤ìŒ ì§ˆë¬¸ â©</button>
    </div>

    <script>
        const chatbox = document.getElementById('chatbox');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        // (í•µì‹¬) ìƒˆë¡œ ë§Œë“  ë²„íŠ¼ì„ ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.
        const nextBtn = document.getElementById('nextBtn');
        let conversationHistory = "";

        async function sendMessage() {
            const message = userInput.value;
            if (!message) return;

            // ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€í•˜ê³  í™”ë©´ì— í‘œì‹œ
            appendUserMessage(message);

            // ì…ë ¥ì°½ ë¹„ìš°ê¸°
            userInput.value = '';

            // AIì—ê²Œ ì‘ë‹µ ìš”ì²­
            await askGeminaiApi();
        }

        // --- (í•µì‹¬) 'ë‹¤ìŒ ì§ˆë¬¸' ë²„íŠ¼ì„ ìœ„í•œ ìƒˆ í•¨ìˆ˜ ---
        async function getNextQuestion() {
            const skipMessage = "ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°€ ì£¼ì„¸ìš”.";

            // 'ë‹¤ìŒ ì§ˆë¬¸' ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìê°€ ë³´ë‚¸ ê²ƒì²˜ëŸ¼ ì²˜ë¦¬í•˜ì—¬ AIê°€ ë¬¸ë§¥ì„ ì´í•´í•˜ê²Œ í•¨
            appendUserMessage(skipMessage);

            // AIì—ê²Œ ìƒˆë¡œìš´ ì§ˆë¬¸ ìš”ì²­
            await askGeminaiApi();
        }
        
        // --- (í•µì‹¬) ì¤‘ë³µ ì½”ë“œë¥¼ ì •ë¦¬í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ë“¤ ---

        // ì‚¬ìš©ìì˜ ë©”ì‹œì§€ë¥¼ í™”ë©´ê³¼ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
        function appendUserMessage(message) {
            chatbox.innerHTML += `<div class="user-msg"><b>ë‚˜:</b> ${message}</div>`;
            conversationHistory += `\n- User: ${message}`;
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // Gemini ë‹µë³€ì„ í™”ë©´ê³¼ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
        function appendGeminiMessage(message) {
            const formattedMessage = message.replace(/\n/g, '<br>');
            chatbox.innerHTML += `<div class="gemini-msg"><b>ë©´ì ‘ê´€:</b> ${formattedMessage}</div>`;
            conversationHistory += `\n- AI: ${message}`;
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // ì„œë²„(API)ì— ì§ˆë¬¸ì„ ë³´ë‚´ê³  ë‹µë³€ì„ ë°›ëŠ” ê³µí†µ í•¨ìˆ˜
        async function askGeminaiApi() {
            try {
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: conversationHistory })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const data = await response.json();
                appendGeminiMessage(data.answer);

            } catch (error) {
                console.error("Fetch error:", error);
                appendGeminiMessage(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
        
        // (í•µì‹¬) 'ë‹¤ìŒ ì§ˆë¬¸' ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
        nextBtn.addEventListener('click', getNextQuestion);
    </script>
</body>
</html>